name: Validate PR Description

on:
  pull_request:
    types: [opened, edited, synchronize]

jobs:
  validate-pr-description:
    runs-on: ubuntu-latest
    steps:
      - name: ğŸ“¥ Get PR Body
        id: pr
        uses: actions-ecosystem/action-get-merged-pull-request@v1
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}

      - name: ğŸ•µï¸ Validate Release Notes
        run: |
          BODY=$(echo "${{ steps.pr.outputs.body }}")

          echo "ğŸ” Checking Summary..."
          SUMMARY_CONTENT=$(echo "$BODY" | awk '/## ğŸ“Œ Summary/{flag=1;next}/---/{flag=0}flag' | grep -vE "^\s*<!--" | grep -vE "^\s*$")
          if [ -z "$SUMMARY_CONTENT" ]; then
          echo "âŒ Summary section is empty"
          exit 1
          fi

          echo "ğŸ” Checking Changes..."
          if ! echo "$BODY" | grep -q "\- \[x\]"; then
            echo "âŒ No change type has been checked"
            exit 1
          fi

          echo "ğŸ” Checking Description..."
          FEATURES=$(echo "$BODY" | awk '/### âœ¨ New Features/{getline; print}')
          BUGS=$(echo "$BODY" | awk '/### ğŸ› Bug Fixes/{getline; print}')
          DOCS=$(echo "$BODY" | awk '/### ğŸ“š Documentation/{getline; print}')

          if [[ "$FEATURES" =~ ^\-$ ]] && [[ "$BUGS" =~ ^\-$ ]] && [[ "$DOCS" =~ ^\-$ ]]; then
            echo "âŒ All description sections are empty"
            exit 1
          fi

          echo "âœ… Release notes validation passed!"