name: Validate PR Description

on:
  pull_request:
    types: [opened, edited, synchronize]

jobs:
  validate-pr-description:
    runs-on: ubuntu-latest
    steps:
      - name: 📥 Get PR Body
        id: pr
        uses: actions-ecosystem/action-get-merged-pull-request@v1
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}

      - name: 🕵️ Validate Release Notes
        run: |
          BODY=$(echo "${{ steps.pr.outputs.body }}")

          echo "🔎 Checking Summary..."
          SUMMARY_CONTENT=$(echo "$BODY" | awk '/## 📌 Summary/{flag=1;next}/---/{flag=0}flag' | grep -vE "^\s*<!--" | grep -vE "^\s*$")
          if [ -z "$SUMMARY_CONTENT" ]; then
          echo "❌ Summary section is empty"
          exit 1
          fi

          echo "🔎 Checking Changes..."
          if ! echo "$BODY" | grep -q "\- \[x\]"; then
            echo "❌ No change type has been checked"
            exit 1
          fi

          echo "🔎 Checking Description..."
          FEATURES=$(echo "$BODY" | awk '/### ✨ New Features/{getline; print}')
          BUGS=$(echo "$BODY" | awk '/### 🐛 Bug Fixes/{getline; print}')
          DOCS=$(echo "$BODY" | awk '/### 📚 Documentation/{getline; print}')

          if [[ "$FEATURES" =~ ^\-$ ]] && [[ "$BUGS" =~ ^\-$ ]] && [[ "$DOCS" =~ ^\-$ ]]; then
            echo "❌ All description sections are empty"
            exit 1
          fi

          echo "✅ Release notes validation passed!"